name: Sync to ModelScope

on:
  push:
    branches: [ main ]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Push to ModelScope
        run: |
          # 1. 清理并提取变量（去除潜在的换行符）
          MS_USER=$(echo "${{ secrets.MODELSCOPE_USERNAME }}" | tr -d '[:space:]')
          MS_PASS=$(echo "${{ secrets.MODELSCOPE_TOKEN }}" | tr -d '[:space:]')
          
          # 2. 核心修正：构建魔搭要求的标准 Git 地址
          # 注意：魔搭的 Git 地址通常在用户名后需要接项目名
          # 请确认你的项目名是 amazon-refund-analysis
          REMOTE_URL="https://www.modelscope.cn/studios/${MS_USER}/amazon-refund-analysis.git"
          
          # 3. 使用凭证存储避免 405 错误
          git config --global user.email "sync@example.com"
          git config --global user.name "GithubSync"
          
          # 利用 git 的 credential 机制处理认证，而不是直接写在 URL 里
          git remote add modelscope "$REMOTE_URL"
          
          # 使用预定义的认证信息进行推送
          # 这里的 http.extraheader 是一种绕过某些服务器 405 限制的高级技巧
          git push -f "https://${MS_USER}:${MS_PASS}@www.modelscope.cn/studios/${MS_USER}/amazon-refund-analysis.git" main
